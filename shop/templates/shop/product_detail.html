{% extends 'base.html' %}
{% load static %}

{% block title %}{{ product.name }} - Mistik Mağaza{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <!-- Ürün Görselleri -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0" style="border-radius: 20px; overflow: hidden;">
                {% if product.image %}
                <img src="{{ product.image }}" class="card-img-top" alt="{{ product.name }}" style="width: 100%; height: 500px; object-fit: cover;">
                {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center" style="height: 500px;">
                    <i class="fas fa-image fa-5x text-muted"></i>
                </div>
                {% endif %}
            </div>
            
            <!-- Ek Görseller -->
            {% if product.image_2 or product.image_3 %}
            <div class="row mt-3 g-2">
                {% if product.image_2 %}
                <div class="col-6">
                    <img src="{{ product.image_2 }}" class="img-fluid rounded" alt="{{ product.name }}" style="height: 150px; width: 100%; object-fit: cover;">
                </div>
                {% endif %}
                {% if product.image_3 %}
                <div class="col-6">
                    <img src="{{ product.image_3 }}" class="img-fluid rounded" alt="{{ product.name }}" style="height: 150px; width: 100%; object-fit: cover;">
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>

        <!-- Ürün Bilgileri -->
        <div class="col-lg-6">
            <div class="card shadow-sm border-0" style="border-radius: 20px;">
                <div class="card-body bg-white p-4" style="border-radius: 20px;">
                    <div class="mb-3">
                        <span class="badge bg-primary">{{ product.category.name }}</span>
                        {% if product.stock_status == 'in_stock' %}
                        <span class="badge bg-success">Stokta</span>
                        {% elif product.stock_status == 'low_stock' %}
                        <span class="badge bg-warning">Son {{ product.stock }} adet</span>
                        {% else %}
                        <span class="badge bg-danger">Stokta Yok</span>
                        {% endif %}
                    </div>

                    <h1 class="display-5 mb-3">{{ product.name }}</h1>
                    
                    <p class="lead text-muted">{{ product.short_description }}</p>

                    <!-- Fiyat -->
                    <div class="mb-4">
                        {% if product.has_discount %}
                        <div class="d-flex align-items-center gap-3">
                            <span class="text-muted text-decoration-line-through fs-4">{{ product.original_price }} ₺</span>
                            <span class="badge bg-danger fs-6">-%{{ product.discount_percentage }}</span>
                        </div>
                        <h2 class="text-primary mb-0">{{ product.price }} ₺</h2>
                        {% else %}
                        <h2 class="text-primary mb-0">{{ product.price }} ₺</h2>
                        {% endif %}
                    </div>

                    <!-- Sepete Ekle -->
                    {% if product.is_in_stock %}
                    <form method="post" action="{% url 'shop:add_to_cart' product.id %}" class="mb-4">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary btn-lg w-100">
                            <i class="fas fa-shopping-cart me-2"></i>Sepete Ekle
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary btn-lg w-100 mb-4" disabled>
                        <i class="fas fa-times me-2"></i>Stokta Yok
                    </button>
                    {% endif %}

                    <!-- Özellikler -->
                    {% if product.features %}
                    <div class="mb-4">
                        <h5 class="mb-3"><i class="fas fa-list me-2"></i>Özellikler</h5>
                        <ul class="list-unstyled">
                            {% for feature in product.features.splitlines %}
                            <li class="mb-2"><i class="fas fa-check text-success me-2"></i>{{ feature }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}

                    <!-- Uygun Burçlar -->
                    {% if product.zodiac_signs %}
                    <div class="alert alert-info">
                        <h6 class="mb-2"><i class="fas fa-star me-2"></i>Uygun Burçlar:</h6>
                        <p class="mb-0">{{ product.zodiac_signs }}</p>
                    </div>
                    {% endif %}

                    <!-- İstatistikler -->
                    <div class="text-muted small">
                        <i class="fas fa-eye me-1"></i>{{ product.views }} görüntülenme
                        <i class="fas fa-shopping-bag ms-3 me-1"></i>{{ product.sales_count }} satış
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Açıklama -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-0" style="border-radius: 20px;">
                <div class="card-body bg-white p-4" style="border-radius: 20px;">
                    <h4 class="mb-3"><i class="fas fa-info-circle me-2"></i>Ürün Açıklaması</h4>
                    <p style="white-space: pre-line;">{{ product.description }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- İlgili Ürünler -->
    {% if related_products %}
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="mb-4"><i class="fas fa-th me-2"></i>Benzer Ürünler</h3>
        </div>
        {% for related in related_products %}
        <div class="col-md-6 col-lg-3 mb-4">
            <div class="card h-100 border-0 shadow-sm" style="border-radius: 15px; overflow: hidden;">
                <a href="{% url 'shop:product_detail' related.slug %}">
                    {% if related.image %}
                    <img src="{{ related.image }}" class="card-img-top" alt="{{ related.name }}" style="height: 200px; object-fit: cover;">
                    {% else %}
                    <div class="bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                        <i class="fas fa-image fa-2x text-muted"></i>
                    </div>
                    {% endif %}
                </a>
                <div class="card-body bg-white">
                    <h6 class="card-title">{{ related.name }}</h6>
                    <p class="text-primary fw-bold">{{ related.price }} ₺</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}
